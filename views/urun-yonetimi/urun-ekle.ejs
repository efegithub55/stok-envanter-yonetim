<!DOCTYPE html>
<html lang="en">
  <%- include("../../components/Head", { title: "Ürün Ekle" } ) %>
  <body class="light" style="display: flex">
    <!-- Sidebar -->
    <%- include("../../components/Sidebar", { active: "yeni-urun" }) %>
    <!-- Main -->
    <form
      action="/urun-yonetimi/yeni-urun"
      method="POST"
      class="form"
      enctype="multipart/form-data"
    >
      <main id="dashboard-main">
        <div class="dash-header">
          <div class="col">
            <h2>Yeni Ürün Ekle</h2>
            <p>Stok sisteminize yeni ürün ekleyin</p>
          </div>
          <div class="col">
            <div class="row">
              <button
                type="submit"
                class="center btn btn-primary min-w-100"
                onclick="event.preventDefault(); this.closest('form').submit();"
              >
                <span class="text"
                  ><span class="bxr bx-check"></span>Kaydet</span
                >
                <span class="spinner"></span>
              </button>
            </div>
          </div>
        </div>
        <!-- Add Product Form -->

        <div class="form-grid">
          <div class="form-grid-item">
            <div class="form-header">
              <h4><span class="bxr bx-edit-alt"></span>Temel Bilgiler</h4>
            </div>
            <div class="form-divider"></div>
            <div class="form-input">
              <label for="urun_adi">Ürün Adı <strong>*</strong></label>
              <input
                type="text"
                placeholder="Örn: iPhone 13 Pro Max 256GB"
                name="urun_adi"
                autocomplete="off"
              />
            </div>
            <div class="form-input">
              <label for="kategori_id">Kategori <strong>*</strong></label>
              <select name="kategori_id" id="kategori_id">
                <option selected disabled>Kategori Seçin</option>
                <% categories.forEach((ctg) => { %>
                <option value="<%= ctg.id %>"><%= ctg.kategori_adi %></option>
                <% }) %>
              </select>
            </div>
            <div class="form-input">
              <label for="barkod">Barkod / EAN</label>
              <input
                type="text"
                placeholder="8690000000000"
                name="barkod"
                maxlength="13"
              />
              <p>13 haneli barkod numarası</p>
            </div>
            <div class="form-input">
              <label for="sku">Stok Kodu</label>
              <input type="text" name="sku" placeholder="IPH-13-PM-128" />
              <p>Benzersiz ürün tanımlayıcısı</p>
            </div>
            <div class="form-input">
              <label for="aciklama">Açıklama</label>
              <textarea
                name="aciklama"
                placeholder="Ürün hakkında detaylı bilgi..."
              ></textarea>
              <p>Markdown formatında yazabilirsiniz</p>
            </div>
            <div class="form-input">
              <label for="imageInput">Ürün Resmi</label>

              <div class="dropzone" id="dropzone">
                <p class="dropzone-text">Buraya sürükle & bırak veya tıkla</p>

                <!-- Önizleme -->
                <img
                  id="imagePreview"
                  class="image-preview"
                  style="display: none"
                />

                <!-- Gerçek progress bar -->
                <div
                  class="upload-progress"
                  id="uploadProgress"
                  style="display: none"
                >
                  <div class="upload-progress-bar" id="uploadProgressBar"></div>
                </div>

                <input
                  type="file"
                  id="imageInput"
                  accept="image/*"
                  name="urun_resmi"
                  hidden
                />
              </div>
            </div>
          </div>
          <div class="form-grid-item">
            <div class="form-header">
              <h4>
                <span class="bxr bx-package"></span>Stok & Fiyat Bilgileri
              </h4>
            </div>
            <div class="form-divider"></div>
            <div class="form-input">
              <label for="mevcut_stok">Mevcut Stok <strong>*</strong></label>
              <input
                type="number"
                min="0"
                placeholder="0"
                name="mevcut_stok"
                class="calc-inp"
              />
              <p>Şu anda depodaki ürün miktarı</p>
            </div>
            <div class="form-input">
              <label for="min_stok"
                >Minimum Stok Seviyesi <strong>*</strong></label
              >
              <input type="number" min="0" placeholder="10" name="min_stok" />
              <p>Bu seviyenin altında uyarı alırsınız</p>
            </div>
            <div class="form-input">
              <label for="max_stok">Maksimum Stok Seviyesi</label>
              <input type="number" placeholder="500" min="0" name="max_stok" />
              <p>Fazla stok uyarısı için (opsiyonel)</p>
            </div>
            <div class="form-input">
              <label for="birim_id">Birim <strong>*</strong></label>
              <select name="birim_id" id="birim_id">
                <% units.forEach((unit) => { %>
                <option value="<%= unit.id %>"><%= unit.ad %></option>
                <% }) %>
              </select>
            </div>
            <div class="form-input">
              <label for="alis_fiyati">Alış Fiyatı <strong>*</strong></label>
              <div class="input-group">
                <div class="input-tag">
                  <span class="bxr bx-lira"></span>
                </div>
                <input
                  type="number"
                  placeholder="0.00"
                  name="alis_fiyati"
                  min="0"
                  class="calc-inp"
                />
              </div>
              <p>Tedarikçiden aldığınız fiyat</p>
            </div>
            <div class="form-input">
              <label for="satis_fiyati">Satış Fiyatı <strong>*</strong></label>
              <div class="input-group">
                <div class="input-tag">
                  <span class="bxr bx-lira"></span>
                </div>
                <input
                  type="number"
                  placeholder="0.00"
                  name="satis_fiyati"
                  min="0"
                  class="calc-inp"
                />
              </div>
              <p>Müşteriye satış fiyatı</p>
            </div>
            <div class="form-input">
              <label for="kdv">KDV Oranı</label>
              <div class="input-group">
                <div class="input-tag">
                  <span class="bxr bx-percentage"></span>
                </div>
                <input
                  type="number"
                  placeholder="0"
                  min="0"
                  name="kdv"
                  class="calc-inp"
                />
              </div>
            </div>
            <div class="calculate-zone">
              <div class="row">
                <div class="col"><p>Kar Marjı:</p></div>
                <div class="col">
                  <span class="calc-success" id="kar_marji">%0</span>
                </div>
              </div>
              <div class="row">
                <div class="col"><p>Birim Kar:</p></div>
                <div class="col"><span id="birim_kar">₺0.00</span></div>
              </div>
              <div class="row">
                <div class="col">
                  <strong>Toplam Envanter Değeri:</strong>
                </div>
                <div class="col"><span id="envanter_deger">₺0.00</span></div>
              </div>
            </div>
          </div>
          <div class="form-grid-item" style="grid-column: span 2 / span 2">
            <div class="form-header">
              <h4>
                <span class="bxr bx-clipboard-detail"></span>Ek Bilgiler
                (Opsiyonel)
              </h4>
            </div>
            <div class="form-divider"></div>
            <div class="form-row">
              <div class="form-input">
                <label for="tedarikci">Tedarikçi</label>
                <input
                  type="text"
                  placeholder="Tedarikçi XYZ"
                  name="tedarikci"
                />
              </div>
              <div class="form-input">
                <label for="raf_konumu">Raf/Depo Konumu</label>
                <input
                  type="text"
                  name="raf_konumu"
                  placeholder="Örn: A12-R3-S5"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-input">
                <label for="garanti">Garanti Süresi (Gün)</label>
                <div class="form-input-row">
                  <input
                    type="number"
                    min="0"
                    name="garanti"
                    placeholder="730"
                  />
                </div>
              </div>
              <div class="form-input">
                <label for="son_kullanma_tarihi">Son Kullanma Tarihi</label>
                <input
                  type="date"
                  name="son_kullanma_tarihi"
                  class="border-default"
                />
              </div>
            </div>
            <div class="form-input">
              <label for="urun_link">Ürün Linki (E-ticaret)</label>
              <input
                type="url"
                name="urun_link"
                placeholder="https://example.com/urun"
              />
            </div>
          </div>
        </div>
      </main>
    </form>
    <!-- Scripts -->
    <script src="/assets/js/loading.helper.js"></script>
    <script src="/assets/js/dragdrop.js"></script>
    <script src="/assets/js/calculate.js"></script>
  </body>
</html>
